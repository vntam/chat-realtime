openapi: 3.0.3
info:
  title: Real-Time Chat System API
  version: 2.0.0
  description: |
    REST API documentation for Chat Backend microservices.
    
    **Architecture:**
    - **API Gateway** (port 3000): Reverse proxy for all services
    - **User Service** (port 3001): Authentication, user management, roles
    - **Chat Service** (port 3002): **WebSocket-only** for messaging + REST for file upload
    - **Notification Service** (port 3003): Notifications via REST + WebSocket
    
    **Important Notes:**
    - üîå **Chat messaging uses WebSocket ONLY** - See `/ws-docs` endpoint or `websocket_doc.md`
    - üìÅ **File upload uses REST API** - See `/upload` endpoints below
    - üîê **JWT required** for most endpoints (except public auth endpoints)
    - üîÑ **All requests go through API Gateway** in production
    
    **WebSocket Documentation:**
    - Chat WebSocket: `GET http://localhost:3002/ws-docs` (custom JSON docs)
    - Notification WebSocket: See `websocket_doc.md`
servers:
  - url: http://localhost:3000
    description: API Gateway (Production - Recommended)
  - url: http://localhost:3001
    description: User Service (Direct - Dev only)
  - url: http://localhost:3002
    description: Chat Service (Direct - Dev only)
  - url: http://localhost:3003
    description: Notification Service (Direct - Dev only)

security:
  - BearerAuth: []

tags:
  - name: Authentication
    description: User registration, login, token refresh (Public endpoints)
  - name: User Management
    description: User CRUD, search, profile (User Service)
  - name: Role Management
    description: Role CRUD, user-role assignment (User Service)
  - name: File Upload
    description: Upload/delete files for chat attachments (Chat Service - REST only)
  - name: Notifications
    description: Notification CRUD, broadcast (Notification Service - REST + WebSocket)
  - name: WebSocket Documentation
    description: Links to WebSocket event documentation

paths:
  # ==========================
  # AUTHENTICATION
  # ==========================
  /auth/register:
    post:
      tags: [Authentication]
      summary: ƒêƒÉng k√Ω t√†i kho·∫£n m·ªõi (public)
      description: Cho ph√©p user t·ª± t·∫°o t√†i kho·∫£n. Endpoint n√†y **kh√¥ng c·∫ßn JWT**.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegisterRequest'
      responses:
        '201':
          description: User ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá ho·∫∑c user ƒë√£ t·ªìn t·∫°i

  /auth/login:
    post:
      tags: [Authentication]
      summary: ƒêƒÉng nh·∫≠p (public)
      description: Tr·∫£ v·ªÅ access token v√† refresh token.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Token tr·∫£ v·ªÅ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Th√¥ng tin ƒëƒÉng nh·∫≠p kh√¥ng h·ª£p l·ªá

  /auth/refresh:
    post:
      tags: [Authentication]
      summary: L√†m m·ªõi access token
      description: D√πng refresh token (g·ª≠i trong header `Authorization: Bearer <refreshToken>`) ƒë·ªÉ l·∫•y c·∫∑p token m·ªõi.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Token m·ªõi ƒë∆∞·ª£c c·∫•p
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /auth/logout:
    post:
      tags: [Authentication]
      summary: ƒêƒÉng xu·∫•t v√† thu h·ªìi refresh token
      security:
        - BearerAuth: []
      responses:
        '200':
          description: ƒêƒÉng xu·∫•t th√†nh c√¥ng
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Logout successfully

  # ==========================
  # USER SERVICE
  # ==========================
  /users:
    get:
      tags: [User Management]
      summary: Search and list users (Public)
      description: |
        Search users with pagination, filtering and sorting.
        - **Public endpoint** - No authentication required
        - Backend searches both `username` AND `email` fields
        - All query parameters are optional
        - Returns paginated response with metadata
      security: []
      parameters:
        - name: search
          in: query
          required: false
          description: T·ª´ kh√≥a t√¨m ki·∫øm (nh·∫≠p username ho·∫∑c email ƒë·ªÅu ƒë∆∞·ª£c)
          schema:
            type: string
            example: alice
        - name: status
          in: query
          required: false
          description: L·ªçc theo tr·∫°ng th√°i
          schema:
            type: string
            enum: [active, inactive, suspended]
            example: active
        - name: role
          in: query
          required: false
          description: L·ªçc theo t√™n role
          schema:
            type: string
            example: admin
        - name: page
          in: query
          required: false
          description: S·ªë trang (b·∫Øt ƒë·∫ßu t·ª´ 1)
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: limit
          in: query
          required: false
          description: S·ªë l∆∞·ª£ng items m·ªói trang
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
            example: 10
        - name: sortBy
          in: query
          required: false
          description: Tr∆∞·ªùng ƒë·ªÉ s·∫Øp x·∫øp
          schema:
            type: string
            enum: [username, email, created_at, status]
            default: created_at
            example: created_at
        - name: sortOrder
          in: query
          required: false
          description: Th·ª© t·ª± s·∫Øp x·∫øp
          schema:
            type: string
            enum: [ASC, DESC]
            default: DESC
            example: DESC
      responses:
        '200':
          description: K·∫øt qu·∫£ t√¨m ki·∫øm v·ªõi pagination
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedUserResponse'
        '400':
          description: D·ªØ li·ªáu query kh√¥ng h·ª£p l·ªá

    post:
      tags: [User Management]  
      summary: Create new user (Admin only)
      description: |
        Create a new user account.
        - **Requires JWT authentication**
        - **Requires admin role**
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreateRequest'
      responses:
        '201':
          description: User ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /users/me:
    get:
      tags: [User Management]
      summary: L·∫•y th√¥ng tin ƒë·∫ßy ƒë·ªß c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i t·ª´ JWT
      description: |
        Tr·∫£ v·ªÅ th√¥ng tin ƒë·∫ßy ƒë·ªß c·ªßa user hi·ªán t·∫°i (d·ª±a tr√™n JWT token).
        
        **Kh√°c bi·ªát v·ªõi GET /users/{id}:**
        - `GET /users/me`: Tr·∫£ v·ªÅ th√¥ng tin ƒë·∫ßy ƒë·ªß c·ªßa ch√≠nh m√¨nh (c√≥ email)
        - `GET /users/{id}`: Ch·ªâ tr·∫£ v·ªÅ th√¥ng tin c√¥ng khai (kh√¥ng c√≥ email, user_id, roles, groups)
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin ƒë·∫ßy ƒë·ªß c·ªßa user hi·ªán t·∫°i
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized - Token kh√¥ng h·ª£p l·ªá

  /users/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    get:
      tags: [User Management]
      summary: Get public user info by ID (No auth required)
      description: |
        Tr·∫£ v·ªÅ th√¥ng tin c√¥ng khai c·ªßa user (d√πng khi user kh√°c xem profile).
        
        **L∆∞u √Ω:** ƒê·ªÉ xem th√¥ng tin ƒë·∫ßy ƒë·ªß c·ªßa ch√≠nh m√¨nh (c√≥ email), d√πng `GET /users/me`
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin user c√¥ng khai (ch·ªâ ch·ª©a d·ªØ li·ªáu an to√†n)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicUser'
        '404':
          description: User kh√¥ng t·ªìn t·∫°i

    patch:
      tags: [User Management]
      summary: Update user information (Self only)
      description: |
        Ch·ªâ cho ph√©p user c·∫≠p nh·∫≠t th√¥ng tin c·ªßa ch√≠nh m√¨nh.
        - User ID t·ª´ JWT token ph·∫£i kh·ªõp v·ªõi `id` trong path parameter.
        - N·∫øu kh√¥ng kh·ªõp, tr·∫£ v·ªÅ l·ªói 403 Forbidden.
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdateRequest'
      responses:
        '200':
          description: User ƒë∆∞·ª£c c·∫≠p nh·∫≠t
        '403':
          description: Kh√¥ng c√≥ quy·ªÅn c·∫≠p nh·∫≠t user kh√°c
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 403
                  message:
                    type: string
                    example: 'B·∫°n ch·ªâ c√≥ th·ªÉ c·∫≠p nh·∫≠t th√¥ng tin c·ªßa ch√≠nh m√¨nh'
                  error:
                    type: string
                    example: Forbidden

    delete:
      tags: [User Management]
      summary: Delete user account (Self only)
      description: |
        Ch·ªâ cho ph√©p user x√≥a t√†i kho·∫£n c·ªßa ch√≠nh m√¨nh.
        - User ID t·ª´ JWT token ph·∫£i kh·ªõp v·ªõi `id` trong path parameter.
        - N·∫øu kh√¥ng kh·ªõp, tr·∫£ v·ªÅ l·ªói 403 Forbidden.
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng
        '403':
          description: Kh√¥ng c√≥ quy·ªÅn x√≥a user kh√°c
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 403
                  message:
                    type: string
                    example: 'B·∫°n ch·ªâ c√≥ th·ªÉ x√≥a t√†i kho·∫£n c·ªßa ch√≠nh m√¨nh'
                  error:
                    type: string
                    example: Forbidden

  /users/{id}/roles:
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: integer }
    get:
      tags: [Role Management]
      summary: Get user's roles
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Roles hi·ªán t·∫°i
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/RoleAssignment' }
    post:
      tags: [Role Management]
      summary: Assign role to user (Admin only)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRoleRequest'
      responses:
        '200':
          description: Role ƒë∆∞·ª£c g√°n
    delete:
      tags: [Role Management]
      summary: Remove role from user (Admin only)
      security:
        - BearerAuth: []
      parameters:
        - name: roleId
          in: query
          required: true
          schema: { type: integer }
      responses:
        '204':
          description: ƒê√£ g·ª° role

  /roles:
    get:
      tags: [Role Management]
      summary: List all roles (Public)
      description: |
        Get list of roles with pagination, filtering and sorting.
        - **Public endpoint** - No authentication required
        - All query parameters are optional
        - Returns paginated response with metadata
      security: []
      parameters:
        - name: search
          in: query
          required: false
          description: T·ª´ kh√≥a t√¨m ki·∫øm (t√™n role)
          schema:
            type: string
            example: admin
        - name: page
          in: query
          required: false
          description: S·ªë trang (b·∫Øt ƒë·∫ßu t·ª´ 1)
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: limit
          in: query
          required: false
          description: S·ªë l∆∞·ª£ng items m·ªói trang
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
            example: 20
        - name: sortBy
          in: query
          required: false
          description: Tr∆∞·ªùng ƒë·ªÉ s·∫Øp x·∫øp
          schema:
            type: string
            enum: [name, role_id]
            default: name
            example: name
        - name: sortOrder
          in: query
          required: false
          description: Th·ª© t·ª± s·∫Øp x·∫øp
          schema:
            type: string
            enum: [ASC, DESC]
            default: ASC
            example: ASC
      responses:
        '200':
          description: Danh s√°ch role v·ªõi pagination
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedRoleResponse'
    post:
      tags: [Role Management]
      summary: Create new role (Admin only)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleCreateRequest'
      responses:
        '201':
          description: Role ƒë∆∞·ª£c t·∫°o
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'

  /roles/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: integer }
    get:
      tags: [Role Management]
      summary: Get role details
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Role
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
    patch:
      tags: [Role Management]
      summary: Update role (Admin only)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleUpdateRequest'
      responses:
        '200':
          description: Role ƒë√£ c·∫≠p nh·∫≠t
    delete:
      tags: [Role Management]
      summary: Delete role (Admin only)
      security:
        - BearerAuth: []
      responses:
        '204':
          description: ƒê√£ x√≥a

  # ==========================
  # FILE UPLOAD (Chat Service - REST only)
  # ==========================
  # Note: Chat messaging uses WebSocket ONLY
  # See /ws-docs endpoint or websocket_doc.md for WebSocket events
  
  /upload/single:
    post:
      tags: [File Upload]
      summary: Upload single file
      description: |
        Upload a single file (image, video, document) for chat attachments.
        - Maximum file size: 10MB (configurable)
        - Supported types: images, videos, documents, audio
        - Returns URL for use in chat messages
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: File to upload
                folder:
                  type: string
                  description: Optional folder path (default: attachments/{userId})
      responses:
        '201':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    description: Public URL of uploaded file
                    example: https://storage.example.com/attachments/123/image.jpg
                  fileType:
                    type: string
                    description: File category
                    enum: [image, video, audio, document, other]
                  fileName:
                    type: string
                    description: Original filename
                  size:
                    type: integer
                    description: File size in bytes
                  mimetype:
                    type: string
                    description: MIME type
        '400':
          description: No file provided or invalid file
        '401':
          description: Unauthorized

  /upload/multiple:
    post:
      tags: [File Upload]
      summary: Upload multiple files (max 10)
      description: |
        Upload multiple files at once.
        - Maximum 10 files per request
        - Each file max 10MB
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [files]
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                  maxItems: 10
                folder:
                  type: string
                  description: Optional folder path
      responses:
        '201':
          description: Files uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  files:
                    type: array
                    items:
                      type: object
                      properties:
                        url: { type: string }
                        fileType: { type: string }
                        fileName: { type: string }
                        size: { type: integer }
                        mimetype: { type: string }
        '400':
          description: No files provided
        '401':
          description: Unauthorized

  /upload:
    delete:
      tags: [File Upload]
      summary: Delete uploaded file
      description: Delete a previously uploaded file from storage.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [fileUrl]
              properties:
                fileUrl:
                  type: string
                  description: URL of file to delete
                  example: https://storage.example.com/attachments/123/image.jpg
      responses:
        '200':
          description: File deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: File deleted successfully
        '400':
          description: File URL is required
        '401':
          description: Unauthorized

  # ==========================
  # WEBSOCKET DOCUMENTATION
  # ==========================
  /ws-docs:
    get:
      tags: [WebSocket Documentation]
      summary: Get Chat WebSocket events documentation (JSON)
      description: |
        Returns JSON documentation for all WebSocket events in Chat Service.
        - **Chat WebSocket namespace:** `ws://localhost:3002/chat`
        - **Via Gateway:** `ws://localhost:3000/chat` (production)
        - See `websocket_doc.md` for detailed guide
      security: []
      responses:
        '200':
          description: WebSocket events documentation
          content:
            application/json:
              schema:
                type: object
                properties:
                  service:
                    type: string
                    example: Chat Service
                  namespace:
                    type: string
                    example: /chat
                  events:
                    type: object
                    description: Client-to-server and server-to-client events

  # ==========================
  # NOTIFICATION SERVICE
  # ==========================
  /notifications:

    get:
      tags: [Notifications]
      summary: Get user's notifications
      security:
        - BearerAuth: []
      parameters:
        - name: unreadOnly
          in: query
          schema:
            type: boolean
            default: false
          description: Ch·ªâ l·∫•y th√¥ng b√°o ch∆∞a ƒë·ªçc n·∫øu true
      responses:
        '200':
          description: Danh s√°ch th√¥ng b√°o
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Notification' }
        '401':
          description: Unauthorized

    post:
      tags: [Notifications]
      summary: Create notification (Admin or system only)
      description: Ch·ªâ admin ho·∫∑c h·ªá th·ªëng m·ªõi c√≥ quy·ªÅn t·∫°o th√¥ng b√°o.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationCreateRequest'
      responses:
        '201':
          description: T·∫°o th√¥ng b√°o th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Notification'
        '400':
          description: D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá
        '403':
          description: Ch·ªâ admin ho·∫∑c h·ªá th·ªëng m·ªõi c√≥ quy·ªÅn t·∫°o th√¥ng b√°o
        '401':
          description: Unauthorized

  /notifications/broadcast:
    post:
      tags: [Notifications]
      summary: Send broadcast notification (Admin only)
      description: G·ª≠i th√¥ng b√°o ƒë·∫øn t·∫•t c·∫£ ng∆∞·ªùi d√πng trong h·ªá th·ªëng. Ch·ªâ admin m·ªõi c√≥ quy·ªÅn.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, body]
              properties:
                title:
                  type: string
                  description: Ti√™u ƒë·ªÅ th√¥ng b√°o
                body:
                  type: string
                  description: N·ªôi dung th√¥ng b√°o
      responses:
        '200':
          description: Th√¥ng b√°o ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn t·∫•t c·∫£ ng∆∞·ªùi d√πng
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Broadcast notification sent successfully
        '400':
          description: D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá
        '403':
          description: Ch·ªâ admin m·ªõi c√≥ quy·ªÅn g·ª≠i broadcast
        '401':
          description: Unauthorized

  /notifications/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    get:
      tags: [Notifications]
      summary: Get notification details
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Chi ti·∫øt th√¥ng b√°o
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Notification'
        '404':
          description: Th√¥ng b√°o kh√¥ng t·ªìn t·∫°i
        '403':
          description: Kh√¥ng c√≥ quy·ªÅn xem th√¥ng b√°o n√†y
        '401':
          description: Unauthorized

    delete:
      tags: [Notifications]
      summary: Delete notification (Self only)
      description: User ch·ªâ c√≥ th·ªÉ x√≥a th√¥ng b√°o c·ªßa ch√≠nh m√¨nh.
      security:
        - BearerAuth: []
      responses:
        '204':
          description: Th√¥ng b√°o ƒë√£ ƒë∆∞·ª£c x√≥a
        '403':
          description: Kh√¥ng c√≥ quy·ªÅn x√≥a th√¥ng b√°o n√†y
        '404':
          description: Th√¥ng b√°o kh√¥ng t·ªìn t·∫°i
        '401':
          description: Unauthorized

  /notifications/{id}/read:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    post:
      tags: [Notifications]
      summary: Mark notification as read
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng b√°o ƒë√£ ƒë∆∞·ª£c ƒë√°nh d·∫•u ƒë√£ ƒë·ªçc
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Notification'
        '404':
          description: Th√¥ng b√°o kh√¥ng t·ªìn t·∫°i
        '403':
          description: Kh√¥ng c√≥ quy·ªÅn ƒë√°nh d·∫•u th√¥ng b√°o n√†y
        '401':
          description: Unauthorized

  /notifications/unread/count:
    get:
      tags: [Notifications]
      summary: Get unread notification count
      security:
        - BearerAuth: []
      responses:
        '200':
          description: S·ªë l∆∞·ª£ng th√¥ng b√°o ch∆∞a ƒë·ªçc
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    description: T·ªïng s·ªë th√¥ng b√°o ch∆∞a ƒë·ªçc
        '401':
          description: Unauthorized

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      description: |
        Th√¥ng tin ƒë·∫ßy ƒë·ªß c·ªßa user (d√πng cho GET /users/me - th√¥ng tin c·ªßa ch√≠nh m√¨nh).
        Ch·ª©a: username, email, avatar_url, status, created_at
        KH√îNG ch·ª©a: user_id, roles, groups (th√¥ng tin nh·∫°y c·∫£m)
      properties:
        username: { type: string }
        email: { type: string }
        avatar_url: { type: string, nullable: true }
        status: { type: string, nullable: true }
        created_at: { type: string, format: date-time }

    PublicUser:
      type: object
      description: |
        Th√¥ng tin c√¥ng khai c·ªßa user (d√πng cho GET /users/{id} - khi user kh√°c xem profile).
        Ch·ª©a: username, avatar_url, status, created_at
        KH√îNG ch·ª©a: user_id, email, roles, groups (th√¥ng tin nh·∫°y c·∫£m)
      properties:
        username:
          type: string
          description: T√™n ƒëƒÉng nh·∫≠p (c√¥ng khai)
        avatar_url:
          type: string
          description: URL avatar (c√¥ng khai)
          nullable: true
        status:
          type: string
          description: Tr·∫°ng th√°i t√†i kho·∫£n (c√¥ng khai)
          nullable: true
        created_at:
          type: string
          format: date-time
          description: Ng√†y t·∫°o t√†i kho·∫£n
          nullable: true

    UserRegisterRequest:
      type: object
      required: [username, password, confirmPassword, email]
      properties:
        username: { type: string }
        password:
          type: string
          format: password
          minLength: 6
        confirmPassword:
          type: string
          format: password
        email: { type: string, format: email }
        fullName: { type: string }
        avatar_url: { type: string }
        status:
          type: string
          enum: [active, inactive, suspended]

    UserCreateRequest:
      type: object
      required: [username, password, email]
      properties:
        username: { type: string }
        password:
          type: string
          minLength: 6
        email: { type: string, format: email }
        avatar_url: { type: string }
        status: { type: string }

    UserUpdateRequest:
      type: object
      properties:
        username: { type: string }
        email: { type: string, format: email }
        avatar_url: { type: string }
        status: { type: string }

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string, format: email }
        password: { type: string }

    AuthResponse:
      type: object
      properties:
        msg: { type: string }
        accessToken: { type: string }
        refreshToken: { type: string }

    Role:
      type: object
      properties:
        role_id: { type: integer }
        name: { type: string }
        description: { type: string }

    RoleCreateRequest:
      type: object
      required: [name]
      properties:
        name: { type: string }
        description: { type: string }

    RoleUpdateRequest:
      type: object
      properties:
        name: { type: string }
        description: { type: string }

    RoleAssignment:
      type: object
      properties:
        user_id: { type: integer }
        role_id: { type: integer }
        assigned_at: { type: string, format: date-time }
        role:
          $ref: '#/components/schemas/Role'

    UserRoleRequest:
      type: object
      required: [roleId]
      properties:
        roleId: { type: integer }

    Conversation:
      type: object
      properties:
        _id: { type: string }
        type: { type: string, enum: [private, group] }
        participants:
          type: array
          items: { type: integer }
        name:
          type: string
          description: T√™n nh√≥m (ch·ªâ cho group chat)
          nullable: true
        avatar:
          type: string
          description: URL avatar nh√≥m (ch·ªâ cho group chat)
          nullable: true
        admin_id:
          type: integer
          description: ID admin nh√≥m (ch·ªâ cho group chat)
          nullable: true
        moderator_ids:
          type: array
          items: { type: integer }
          description: Danh s√°ch ID moderators (ch·ªâ cho group chat)
          nullable: true
        status:
          type: string
          enum: [pending, accepted, declined]
          description: Status c·ªßa conversation (pending=ch·ªù accept message request)
        initiator_id:
          type: integer
          description: ID ng∆∞·ªùi t·∫°o message request
        created_at: { type: string, format: date-time }

    ConversationCreateRequest:
      type: object
      required: [type, participants]
      properties:
        type:
          type: string
          enum: [private, group]
        participants:
          type: array
          items: { type: integer }
        name:
          type: string
          description: T√™n nh√≥m (b·∫Øt bu·ªôc n·∫øu type='group')
        avatar:
          type: string
          description: URL avatar nh√≥m (t√πy ch·ªçn)

    Message:
      type: object
      properties:
        _id: { type: string }
        sender_id: { type: integer }
        content: { type: string }
        attachments:
          type: array
          items: { type: string }
        seen_by:
          type: array
          items: { type: integer }
        created_at: { type: string, format: date-time }

    MessageSendRequest:
      type: object
      required: [content]
      properties:
        content: { type: string }
        attachments:
          type: array
          items: { type: string }

    Notification:
      type: object
      properties:
        _id: { type: string }
        user_id: { type: integer }
        type:
          type: string
          enum: [message, group_invite, system]
        title: { type: string }
        content: { type: string }
        is_read: { type: boolean }
        related_id: { type: string }
        created_at: { type: string, format: date-time }

    NotificationCreateRequest:
      type: object
      required: [user_id, type, title, content]
      properties:
        user_id: { type: integer }
        type:
          type: string
          enum: [message, group_invite, system]
        title: { type: string }
        content: { type: string }
        related_id: { type: string, nullable: true }

    PaginatedUserResponse:
      type: object
      description: |
        Response cho GET /users - Danh s√°ch users c√¥ng khai v·ªõi pagination.
        M·ªói user trong data ch·ªâ ch·ª©a th√¥ng tin c√¥ng khai (PublicUser).
      properties:
        data:
          type: array
          items: { $ref: '#/components/schemas/PublicUser' }
        total:
          type: integer
          description: T·ªïng s·ªë users
          example: 100
        page:
          type: integer
          description: Trang hi·ªán t·∫°i
          example: 1
        limit:
          type: integer
          description: S·ªë items m·ªói trang
          example: 10
        totalPages:
          type: integer
          description: T·ªïng s·ªë trang
          example: 10

    PaginatedRoleResponse:
      type: object
      properties:
        data:
          type: array
          items: { $ref: '#/components/schemas/Role' }
        total:
          type: integer
          description: T·ªïng s·ªë roles
          example: 50
        page:
          type: integer
          description: Trang hi·ªán t·∫°i
          example: 1
        limit:
          type: integer
          description: S·ªë items m·ªói trang
          example: 20
        totalPages:
          type: integer
          description: T·ªïng s·ªë trang
          example: 3
